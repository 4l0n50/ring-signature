% !TEX root = ../main-ring-signature.tex

Most ring signature constructions have followed the following approach. Given a ring of users, defined by the set of their verification keys, and a message: a) sign the message, b) prove in zero-knowledge knowledge of a signature which can be verified using some committed/randomized verification key, and then c) prove in zero-knowledge that this verification key belongs to the set of public keys in the ring.  The most expensive part is c) and is sometimes called a \emph{set-membership proof}.

We observe that in the case of ring signatures \emph{all the verification keys forming the ring are honestly generated}. 
Indeed, it only makes sense to guarantee unforgeability when all the members of the ring are honest (otherwise the adversary knows at least one secret key) and thus the set-membership proof might assume that all verification keys were honestly generated.
It turns out that all the schemes we are aware of, in particular Chandran et al.'s, obviate this property, meaning that their set-membership proofs are for adversarially chosen verification keys.
We ask the following natural question.
\begin{displayquote}
Can we construct more efficient set membership proofs (without random oracles or non-falsifiable assumptions) when verification keys are sampled from a known distribution?
\end{displayquote}
We answer this question in the affirmative constructing a $\Theta(\sqrt[3]{n})$ set membership proof specially tailored to the case when the verification keys are honestly sampled. In contrast, Chandran et al.'s proof is of size $\Theta(\sqrt{n})$ but it makes no assumption on the verification keys distribution.

\subsubsection{Our Construction from the Permutation Pairing Assumption.}
Our main technical tools are two hash functions compatible with Groth-Sahai proofs. The first funtion, $h$, is \emph{second-preimage resistant} under a slightly different notion of collision. That is, given $\matr{A}=(\vecb{a}_1,\ldots,\allowbreak \vecb{a}_m)$ in the domain of $h$, is hard to find $\matr{A}'$ such that $h(\matr{A}')=h(\matr{A})$ whenever $\matr{A}'$ is not a permutation of $\matr{A}$.

We give a simple instantiation of $h$ based on the permutation pairing assumption (PPA). For simplicity, consider a symmetric bilinear group $\GG$ of order $q$ and generated by $\mathcal{P}$ (though, it can be extended to asymmetric bilinear groups as we show in section \ref{sec:hardness-ass}). This assumption states that, given $\vecb{a}_1 = (x_1\cP,x_1^2\cP),\ldots,\vecb{a}_m=(x_m\cP,x^2_m\cP)$, for $x_1,\ldots,x_m\gets\Z_q$, the only way to compute $\vecb{a}'_1=(y_1\cP,y_1^2\cP),\ldots,\vecb{a}'_m=(y_m\cP,y_m^2\cP)$ such that $\sum_{i=1}^m \vecb{a}'_i = \sum_{i=1}^m\vecb{a}_i$ is to take permutation of $\vecb{a}_1,\ldots,\vecb{a}_m$.  It is straight forward to note that $h(\matr{A}) := \sum_{i=1}^m \vecb{a}_i$ is second-preimage resistant ``modulo permutations'', given the hardness of PPA.

Our second function, $g$, is collision-resistant in the traditional sense. It uses $\matr{A}$ as key and returns $g_\matr{A}(vk_1,\ldots,vk_m) = \sum_{i=1}^m e(\vecb{a}_i,vk_i)$ for $vk_1,\ldots,vk_m\in\GG$.  Groth and Lu conjectured that is hard to find $vk_1,\ldots,vk_n\in\GG$ such that $\sum_{i=1}^m e(\vecb{a}_i,vk_i)=0$ when each $\vecb{a}_i$ is of the form $(x_i\cP,x_i^2\cP)$ and $x_i\gets\Z_q$ \cite{AC:GroLu07}. They give some evidence that this assumption might be true proving its hardness in the generic bilinear group model. It follows that $g$ is collision resistant given the hardness of the aforementioned assumption. The only problem with this definition is that $g$ outputs elements in $\GG_T$. But in order to use Chandran et al.'s set-membership we need $g$'s outputs in the base group. To render $g_\matr{A}(\vecb{vk})\in\GG$ efficiently computable we make $sk_i\vecb{a}_i$ publicly available, where $vk_i = sk_i\cP$, and redefine $g$ as $g_\matr{A}(\vecb{vk}) = \sum_i sk_i\vecb{a}_i$, while its discrete logarithm with respect to $\cP_T = e(\cP,\cP)$ remains the same.

Each $\vecb{a}_i$ will be taken from the ring member's verification keys and hence, since all these verification keys are honestly sampled, when proving unforgeability we may assume that $\matr{A}$ is honestly sampled from the PPA distribution. %Consequently, it follows that $h$ and $g$ are collision resistant.  %Furthermore, is not hard to see that $h$ and $g$ have the following nice property: given $\matr{A},\matr{A}'$ such that $h(\matr{A})=h(\matr{A}')$, then $g_\matr{A}(\vecb{vk})=g_{\matr{A}'}(\vecb{vk}')$ implies that $\vecb{vk}$ is a permutation of $\vecb{vk}'$. 

\subsubsection{High level description.}
In our ring signature, each user possess an ``extended verification key'' which contains the verification key of a Boneh-Boyen signature scheme $vk = sk\cP$ plus  $\vecb{a},vk$ and $sk\vecb{a}$, where $sk$ is the corresponding secret key.\footnote{Although any signature scheme compatible with Groth-Sahai proofs suffices (e.g.~structure preserving signatures), we rather keep it simple and stick to Boneh-Boyen signature which, since the verification key is just one group element, simplifies the notation and reduces the size of the final signature.} We want to show that some commitment $c$ opens to $vk$ and $vk\in\{vk_1,\ldots,vk_n\}$. To do so, we arrange the $n$ elements of the ring into $n^{2/3}$ blocks of size $m=\sqrt[3]{n}$. We use the following notation: for $\{s_1,\ldots, s_n\}$ define $s_{i,j}:=s_{(i-1)m+j}$, where  $1\leq i \leq n^{2/3},1\leq  j \leq m$. Assume that $vk = vk_{\mu,\nu}$.

Split $(\vecb{a}_{1},\ldots, \vecb{a}_{n})$ into $\matr{A}_i := (\vecb{a}_{i,1},\ldots,\vecb{a}_{i,m})$ and $(vk_1,\ldots,vk_n)$ into $\vecb{vk}_i = (vk_{i,1},\ldots,vk_{i,m})$,  for $1\leq i\leq n^{2/3}$, and define $H\allowbreak:=\{h(\matr{A}_1),\allowbreak\ldots,\allowbreak h(\matr{A}_{n^{2/3}})\}$ and $G := \{g_{\matr{A}_1}(\vecb{vk}_1),\ldots,g_{\matr{A}_{n^{2/3}}}(\vecb{vk}_{n^{2/3}})\}$.  
We use Chandran et al.'s set-membership proof of size $\Theta(\sqrt{n})$ to prove knowledge of some $h(\matr{A}_\mu)\in H$. Since $|H|=n^{2/3}$, this proof is of size $\Theta(\sqrt[3]{n})$. Then we prove knowledge of $\matr{A}'$, a preimage of $h(\matr{A}_\mu)$ such that $\vecb{a}'_1 = \vecb{a}_{\mu,\nu}$, which using Groth-Sahai proofs requires commitments to the $\sqrt[3]{n}$ columns of $\matr{A}'$ plus a $\Theta(1)$ proof that $h(\matr{A}')=h(\matr{A}_\mu)$. Hence, this part of the proof adds up to $\Theta(\sqrt[3]{n})$ group elements.
%Since $h$ is invariant under permutations of the input, we can sort the commitments of the $\sqrt[3]{n}$ elements in $A'$ so that the first commitment is $c$. We conclude that $A'=\matr{A}_\mu$, unless we break second-preimage resistance of $h$, and thus $a$, the opening of $c$, belongs to $\{\vecb{a}_1,\ldots,\vecb{a}_n\}$.

We give a second set-membership proof of knowledge of some
$g_{\matr{A}_{\mu'}}(\vecb{vk}_{\mu'})\in G$ such that $\mu'=\mu$ (this is straightforward to do in Chandran et al.'s set-membership proof).
We commit to $\vecb{vk}'$, a permutation of $\vecb{vk}_\mu$ such that $vk'_1=vk_{\mu,\nu}$ (and consistent with $\matr{A}'$), and we prove using Groth-Sahai proofs that $g_{\matr{A}_{\mu'}}(\vecb{vk}_{\mu'}) = g_{\matr{A}'}(\vecb{vk}')$. Again, this part of the proof adds $\Theta(\sqrt[3]{n})$ group elements.

Finally, since $h(\matr{A}')=h(\matr{A}_\mu)$, then $\matr{A}'$ is a permutation of $\matr{A}_\mu$ which can be equivalently written as $\matr{A}' = \matr{A}_\mu\matr{P}$, where $\matr{P}$ is some permutation matrix. Given that  $e(g_{\matr{A}'}(\vecb{vk}'),\cP)  = e(\matr{A}_\mu\matr{P},\vecb{vk}')= e(g_{\matr{A}_\mu}(\matr{P}\vecb{vk}'),\cP) = e(g_{\matr{A}_{\mu}}(\vecb{vk}_\mu),\cP)$, we conclude that $vk'_1,\ldots,vk'_m$ is a permutation of $vk_{\mu,1},\ldots,vk_{\mu,m}$. It follows that $vk_{\mu,\nu}=vk'_1$ is in the ring.
%suffices to give a third set-membership proof that $c$ opens to some element in $\{x_1,\ldots,x_m\}$ to conclude that $vk\in R$. (We can omit the third set-membership proof setting $x_1 =vk_{\mu,\nu}$ plus a clever usage of the ``permutation friendly'' properties of $h$ and $g$).