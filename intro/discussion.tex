% !TEX root = ../main-ring-signature.tex

\subsubsection{Instantiating functions $h$ and $g$}. We give a simple instantiation of $h$ based on the permutation pairing assumption (PPA). For simplicity, consider a symmetric bilinear group $\GG$ of order $q$ and generated by $\mathcal{P}$. This assumption states that, given $\vecb{a}_1 = (x_1\cP,x_1^2\cP),\ldots,\vecb{a}_m=(x_m\cP,x^2_m\cP)$, for $x_1,\ldots,x_m\gets\Z_q$, the only way to compute $\vecb{a}'_1=(y_1\cP,y_1^2\cP),\ldots,\vecb{a}'_m=(y_m\cP,y_m^2\cP)$ such that $\sum_{i=1}^m \vecb{a}'_i = \sum_{i=1}^m\vecb{a}_i$ is to take permutation of $\vecb{a}_1,\ldots,\vecb{a}_m$.  It is straight forward to note that $h(\vecb{a}_1,\ldots,\vecb{a}_m) = \sum_{i=1}^m \vecb{a}_i$ is second-preimage resistant given the hardness of PPA.

Furthermore, Groth and Lu also conjectured that is hard to find $vk_1,\ldots,vk_n\in\GG$ such that $\sum_{i=1}^m e(\vecb{a}_i,vk_i)=0$ \cite{AC:GroLu07}. They give some evidence that this assumption might be true proving its hardness in the generic bilinear group model. It is direct to note that $g_{\vecb{a}_1,\ldots,\vecb{a}_m}(vk_1,\ldots,vk_m) = \sum_{i=1}^m e(\vecb{a}_i,vk_i)$ is collision resistant given the hardness of the aforementioned assumption.\footnote{The only problem with this definition is that $g$ outputs elements in $\GG_T$. To use Chandran et al.'s set-membership we need to get $g$'s output  in the base group. We solve this problem giving $vk_i\vecb{a}_i$ in the base group.}

In addition to being based on non-constant size assumptions (also known as $q$-assumptions), this instantiation of $h$ and $g$ has the following problem. A ring signature must tolerate adaptive corruption of the verification keys. That is, an adversary may adaptively ask for the random coins used for generating the verification keys which in this case amounts to reveal $x_i,x_i^2$. This is incompatible with PPA (unless one considers a much stronger interactive assumption), so the only alternative is to allow the key generation algorithm to erase its random coins.\footnote{We elaborate more on the erasures assumption for ring signatures in App.~\ref{sec:erasures}.}

\subsubsection{Getting rid of the PPA and the erasures asssumption.} Our starting point in the search of a more standard replacement for the permutation pairing assumption is the following. Consider the set of binary vectors of size $m$ and the function $h$ defined as the hamming weight of a binary vector $h(\vecb{\beta}) = \sum_{i=1}^m \beta_i$. Clearly, $h(\vecb{\beta})=h(\vecb{\beta}')$ and $\vecb{\beta},\vecb{\beta}'\in\bits^m$ implies that $\vecb{\beta'}$ is a permutation of $\vecb{\beta}$ unconditionally.
The problem now is that, of course, is easy to find $vk_1,\ldots,{vk}_m$ such that $g_\vecb{\beta}(vk_1,\ldots,vk_m) = \sum_{i=1}^m \beta_i vk_i = 0$. But is also not hard to come up with a solution.

Define $\vecb{a}_i = \Com_{ck}(\beta_i)$, a Groth-Sahai commitment to $\beta_i$, and let $\matr{A} = (\vecb{a}_1,\ldots, \vecb{a}_m)$. Define $h(\matr{A})$ as the hamming weight of $\vecb{\beta} = (\beta_1,\ldots,\beta_m)^\top$ and define $g_{\matr{A}}(\allowbreak vk_1,\ldots,vk_m) = \sum_{i=1}^m \beta_ivk_i$. Note that, since $\vecb{\beta}$ remains hidden, given $(vk'_1,\ldots,vk'_m)\neq (vk_1,\ldots,vk_m)$ such that $g_{\matr{A}}(vk_1,\ldots,vk_m) =g_{\matr{A}}(vk'_1,\ldots,vk'_m)$, we can change $\vecb{\beta}$ to a random binary vector of hamming weight 1. With probability roughly $1/m$, $\vecb{\beta}$ has its unique 1 at the same position $i$ where $vk'_i \neq vk_i$. We conclude that $g$ is collision resistant under the hiding property of Groth-Sahai commitments which in turn, relies on the SXDH assumption.

Although $h$ and $g$ are not efficiently computable, from $\vecb{a}_i$ and $\vecb{d}_i = \Com_{ck}(\beta_ivk_i)$, we can derive commitments to $h(\matr{A})$ and to $g_\matr{A}(vk_1,\ldots,vk_m)$, and we can still use Chandran et al.'s set-membership proof. But now, without knowledge of $\vecb{\beta}$ is not clear how to prove that a)$h(\matr{A}')=h(\matr{A})$, b)$\vecb{\beta}'$, the opening of $\matr{A}'$, is in $\bits^m$,  and c)$g_{\matr{A}}(vk_1,\ldots,vk_m) =g_{\matr{A}'}(vk'_1,\ldots,vk'_m)$.
%whenever $\vecb{a}'_1,\ldots,\vecb{a}'_m$ and $vk'_1,\ldots,vk'_m$ are permutations of $\vecb{a}_1,\ldots,\vecb{a}_m$ and $vk_1,\allowbreak\ldots,vk_m$, respectively.
For simplicity, here we describe a simple but inefficient solution which computes Groth-Sahai commitments of Groth-Sahai commitments (yes! the commitment of a commitment) and Groth-Sahai proofs of the satisfiability of Groth-Sahai verification equations. In section \ref{sec:hf-sxdh} we avoid this problem using re-randomization of Groth-Sahai proofs, introduced in \cite{C:BCCKLS09}.
 
For proving statement a) it suffices to compute a Groth-Sahai proof that $\sum_{i=1}^m \vecb{a}'_i - \sum_{i=1}^m\vecb{a}_i = 0$. Note that this requires computing commitments to $\vecb{a}_i$ to keep anonymity. For  statement b) we add proofs that $\beta_i(\beta_i-1)=0$ and use this proofs to derive a Groth-Sahai proof for the satisfiability of the verification equation of $\beta'_i(\beta'_i-1)=0$ (which requires commitments to Groth-Sahai proofs). For c) we add to the verification key Groth-Sahai proofs that $\beta_i vk_i = y_i$, which allows to derive a proof for $\sum_{i=1}^m \beta_i vk_i = y$ using the homomorphic properties of Groth-Sahai proofs. Again, we give a Groth-Sahai proof of the satisifiability of the verification equation for $\sum_{i=1}^m \beta_i vk_i = y$.

Finally, to avoid erasures we require the function $g$  to remain collision resistant even when the adversary may request the openings some $\vecb{a}_i$s. To do so, we sample $\vecb{a}_i$ with $\beta_i=0$ for all $i$ so that we need to change $\vecb{\beta}$ at a single position. Lets see that $g$ is collision resistant in this strong setting.
Consider a game $\sfGame_0$ where the adversary wins if it finds a collision for $g$. Consider a game $\sfGame_1$ exactly as $\sfGame_0$ but the game aborts if the adversary corrupts $\vecb{a}_i$ or $vk_i = vk'_i$, for some random $i$. Is not hard to see that $\Pr[\sfGame_1]\geq 1/m\Pr[\sfGame_0]$. Now consider another game $\sfGame_2$, exactly as $\sfGame_1$, but where $\beta_i=1$. Note that in $\sfGame_2$ it is impossible to find collisions since $\sum_{j=1}^m\beta_jvk_j = vk_i\neq vk'_i$ (otherwise the game would have aborted). Furthermore, the probability that the adversary finds collisions in $\sfGame_2$ should be essentially the same as in $\sfGame_1$ or we can break the hiding property of $\Com$ embedding a challenge in $\vecb{a}_i$. Note that, for this argument to work, it is crucial that $g_\matr{A}(vk_1,\ldots,vk_m)$ is efficiently computable. Otherwise the distinguisher for $\Com$ will not be efficient. This is one of the main challenges for building $g$ that we face in section \ref{sec:hf-sxdh}. 



%\subsubsection{Extending our technique.}
%A natural question is if this technique can be applied once again. That is, to compute a $\Theta(\sqrt[4]{n})$  proof, compute commitments to an element from $H=\{h(A_1),\ldots,h(A_{n^{3/4}})\}$
%and
%$G=\allowbreak\{
%	g_{[\matr{A}_1]}
%		([
%			\vecb{\kappa}_1]),
%	\ldots,\allowbreak
%	g_{[\matr{A}_{n^3/4}]}
%		([
%			\vecb{\kappa}_{n^{3/4}}
%])\}$,
%and then prove that it belongs to $H$ using our set membership proof of size $\Theta(\sqrt[3]{n})$. Since $|H|=n^{3/4}$, the proof will be of size $\Theta(\sqrt[3]{n^{3/4}})=\Theta(\sqrt[4]{n})$. However, this is not possible since the $\Theta(\sqrt[3]{n})$ proof is not a set-membership proof for arbitrary sets and in fact it doesn't work for elements in the image of $h$. Going a step forward, the proof works for elements of the form $(a\cP_s,a^2\cP_s)$, where $a$ is an integer and $\cP_s$ is a generator of one of the base groups of a bilinear group. On the other hand, the image of $h$ contains elements of the form $\sum_{i=1}^m (a_i\cP_s,a_i^2\cP_s)$ for which we do not know how to construct a function like $h$ and thus, we do not how to construct a set membership proof of size $\Theta(\sqrt[3]{n})$.

%\subsubsection{Getting rid of the Permutation Pairing Assumption.} Gonzalez et al.~\cite{ACNS:GonRaf16} modify Groth and Lu's proof of correctness of a shuffle \cite{AC:GroLu07} to get rid of the permutation pairing assumption. They showed that the statement ``I know two vectors of group elements $(\vecb{a}_1,\ldots,\vecb{a}_m),(\vecb{a}'_1,\ldots,\vecb{a}'_m)$ which are equal up to a permutation'' can be showed with $m$ set membership proofs that $\vecb{a}'_1,\dots\vecb{a}'_m\in\{\vecb{a},\ldots,\vecb{a}_m\}$ and  a proof that$\sum_{i=1}^m \vecb{a}'_i=\sum_{i=1}^m \vecb{a}_i$.  Gonzalez et al.~construct a $\Theta(m)$ proof of the first statement under standard assumptions (DLin in symmetric groups), while the second statement can be proved using standard techniques.

%If we use Gonzalez et al.'s techniques we would have to show that for all $\vecb{a}'\in A',$ $\vecb{a}'\in A_ \mu$. However, we can't do this since $A_\mu$ is unknown to the verifier. Instead, it seems that we are using stronger properties of the permutation pairing assumption. We use $h(A_\mu)$ as a constant-size computationally binding commitment of the set $A_\mu$, i.e.~invariant under permutations of the input, which is also structure preserving, i.e.~$A_\mu\subset\GG^2_1$ and $h(A_\mu)\in\GG_1$. It is an interesting open problem to construct $h$ from standard assumptions (e.g.~DDH, DLin).

\subsubsection{Relation to \cite{AC:GonHevRaf15}.}
Our construction is similar to the set membership proof of Gonzalez et al.~{\cite[Appendix D.2]{AC:GonHevRaf15} also of size $\Theta(\sqrt[3]{n})$. There, the CRS contains a matrix $\matr{A}$ of size $2\times m$ that is used to compute $\sqrt[3]{n}$ hashes of $n^{2/3}$ of subsets of verification keys of size $\sqrt[3]{n}$. Then some hidden hash is shown to belong to the set fo $n^{2/3}$ hashes. These hashes are computed as a linear combination of the columns of $\matr{A}$ with the verification keys.

One could turn this construction into a ring signature including $vk\matr{A}$ in each verification key. However, the fact that $\matr{A}$ is fixed implies that $O(\sqrt[3]{n})$ signatures can be obtained only when $n\leq m^{3}$. So, asymptotically, this is not a $O(\sqrt[3]{n})$ signature. Furthermore, note that the verification key is of size $O(m)$. In contrast, our ring signature verification keys are of size $O(1)$ and the size of the ring is unbounded.
%
%The novelty of our scheme is a distributed generation, at signature time, of the matrix $\matr{A}$, such that each verification key contributes with a constant number of coefficients of $\matr{A}$. This implies that now each hash is computed using different coefficients of $\matr{A}$. But then proving that the hidden hash was honestly computed is much more tricky. Indeed, is essential to include our hash function $h$ which computes a digest for a particular set of coefficients of $\matr{A}$.

%\subsubsection{Kernel and Permutation Pairing Assumption.} The PP assumption might be viewed as a kernel assumption equipped with a hash function with for whose columns 